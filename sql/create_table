CREATE TABLE "public.Movies" (
	"id" serial NOT NULL,
	"name" VARCHAR(255) NOT NULL,
	"release_date" DATE NOT NULL,
	"duration" TIME NOT NULL,
	"mpaa" VARCHAR(5),
	"rating" FLOAT,
    "kp_id" integer UNIQUE ,
	CONSTRAINT "Movies_pk" PRIMARY KEY ("id")
) WITH (
  OIDS=FALSE
);



CREATE TABLE "public.Cinemas" (
	"id" serial NOT NULL,
	"name" VARCHAR(255) NOT NULL,
	"location" VARCHAR(255),
	CONSTRAINT "Cinemas_pk" PRIMARY KEY ("id")
) WITH (
  OIDS=FALSE
);



CREATE TABLE "public.Halls" (
	"id" serial NOT NULL,
	"name" VARCHAR(5) NOT NULL,
	"cinema_id" integer NOT NULL,
	"type" VARCHAR(20),
	CONSTRAINT "Halls_pk" PRIMARY KEY ("id")
) WITH (
  OIDS=FALSE
);



CREATE TABLE "public.Seats" (
	"id" serial NOT NULL,
	"row" integer NOT NULL,
	"place" integer NOT NULL,
	"hall_id" integer NOT NULL,
	CONSTRAINT "Seats_pk" PRIMARY KEY ("id")
) WITH (
  OIDS=FALSE
);


CREATE TABLE "public.Orders" (
    "id" serial NOT NULL,
    "customer_id" integer NOT NULL,
    "total_price" integer NOT NULL,
    "payment_time" TIMESTAMP,
    CONSTRAINT "Orders_pk" PRIMARY KEY ("id")
) WITH (
  OIDS=FALSE
);


CREATE TABLE "public.Customers" (
	"id" serial NOT NULL,
	"name" VARCHAR(255),
	"birthday" DATE,
	"avatar_ref" VARCHAR(255),
    "phone" VARCHAR(255),
    "email" VARCHAR(255),
    "password" VARCHAR(255),
	CONSTRAINT "Customer_pk" PRIMARY KEY ("id")
) WITH (
  OIDS=FALSE
);



CREATE TABLE "public.Sessions" (
	"id" serial NOT NULL,
	"movie_id" integer NOT NULL,
	"hall_id" integer NOT NULL,
	"time" TIMESTAMP NOT NULL,
	CONSTRAINT "Sessions_pk" PRIMARY KEY ("id")
) WITH (
  OIDS=FALSE
);



CREATE TABLE "public.Tickets" (
	"id" serial NOT NULL,
	"seat_id" integer NOT NULL,
	"session_id" integer NOT NULL,
	"price" integer NOT NULL,
    "order_id" integer,
	CONSTRAINT "Tickets_pk" PRIMARY KEY ("id")
) WITH (
  OIDS=FALSE
);



CREATE TABLE "public.Films_crew" (
	"id" serial NOT NULL,
	"movie_id" integer NOT NULL,
	"member_id" integer NOT NULL,
	"position" VARCHAR(255),
	CONSTRAINT "films_crew_pk" PRIMARY KEY ("id")
) WITH (
  OIDS=FALSE
);



CREATE TABLE "public.Film_crew_member" (
	"id" serial NOT NULL,
	"name" VARCHAR(255) NOT NULL,
	CONSTRAINT "film_crew_member_pk" PRIMARY KEY ("id")
) WITH (
  OIDS=FALSE
);

CREATE TABLE "public.Movies_genres" (
    "id" serial NOT NULL,
    "movie_id" integer NOT NULL,
    "genres_name" 
	CONSTRAINT "movies_genres_pk" PRIMARY KEY ("id")
) WITH (
    OIDS = FALSE
)

CREATE TABLE "public.Genres" (
	"name" VARCHAR(20) NOT NULL UNIQUE,
	CONSTRAINT "genres_pk" PRIMARY KEY ("name")
) WITH (
  OIDS=FALSE
);



ALTER TABLE "Movies" ADD CONSTRAINT "Movies_fk0" FOREIGN KEY ("mpaa") REFERENCES "undefined"("undefined");
ALTER TABLE "Movies" ADD CONSTRAINT "Movies_fk1" FOREIGN KEY ("genre") REFERENCES "genres"("name");


ALTER TABLE "Halls" ADD CONSTRAINT "Halls_fk0" FOREIGN KEY ("cinema_id") REFERENCES "Cinemas"("id");

ALTER TABLE "Seats" ADD CONSTRAINT "Seats_fk0" FOREIGN KEY ("hall_id") REFERENCES "Halls"("id");


ALTER TABLE "Sessions" ADD CONSTRAINT "Sessions_fk0" FOREIGN KEY ("movie_id") REFERENCES "Movies"("id");
ALTER TABLE "Sessions" ADD CONSTRAINT "Sessions_fk1" FOREIGN KEY ("hall_id") REFERENCES "Halls"("id");

ALTER TABLE "Tickets" ADD CONSTRAINT "Tickets_fk0" FOREIGN KEY ("order_id") REFERENCES "Orders"("id");
ALTER TABLE "Tickets" ADD CONSTRAINT "Tickets_fk1" FOREIGN KEY ("seat_id") REFERENCES "Seats"("id");
ALTER TABLE "Tickets" ADD CONSTRAINT "Tickets_fk2" FOREIGN KEY ("session_id") REFERENCES "Sessions"("id");

ALTER TABLE "Orders" ADD CONSTRAINT "Oreders_fk0" FOREIGN KEY ("customer_id") REFERENCES "Customers"("id")

ALTER TABLE "films_crew" ADD CONSTRAINT "films_crew_fk0" FOREIGN KEY ("movie_id") REFERENCES "Movies"("id");
ALTER TABLE "films_crew" ADD CONSTRAINT "films_crew_fk1" FOREIGN KEY ("member_id") REFERENCES "film_crew_member"("id");
ALTER TABLE "films_crew" ADD CONSTRAINT "films_crew_fk2" FOREIGN KEY ("position") REFERENCES "positions"("name");
